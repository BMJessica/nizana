---
import image1 from "../assets/image/niza.png";
import image2 from "../assets/image/misi.png";
import image3 from "../assets/image/visi.png";
import image4 from "../assets/image/valo.png";

import Monday from "../components/monday.astro";



const slides = [
    {
        name: "HISTORIA",
        texto: `Desde nuestros inicios hemos apostado por el diseño centrado en las personas. 
            Empezamos como un pequeño estudio y evolucionamos a un equipo multidisciplinario 
            que combina estrategia, branding y producto digital.`,
        img: image1,
    },
    {
        name: "MISIÓN",
        texto: `Nos guiamos por la innovación, la calidad y la excelencia, 
            trabajando con compromiso, responsabilidad y transparencia; 
            valoramos la colaboración, la cercanía y el aprendizaje constante,
            siempre creciendo junto a nuestros clientes y manteniendo nuestra identidad.`,
        img: image2,
    },
    {
        name: "VISIÓN",
        texto: `Convertirnos en un referente en el desarrollo de software,
            reconocido por nuestra calidad, innovación y excelencia técnica.
            Queremos ser un estudio que inspire confianza y creatividad,
            creciendo junto a nuestros clientes y consolidándonos como un aliado estratégico para pequeñas 
            y medianas empresas, transformando pequeñas ideas en grandes soluciones.`,
        img: image3,
    },
    {
        name: "VALORES",
        texto: `Nos guiamos por la innovación, la calidad y la excelencia,
            trabajando con compromiso, responsabilidad y transparencia; 
            valoramos la colaboración, la cercanía y el aprendizaje constante, 
            siempre creciendo junto a nuestros clientes y manteniendo nuestra identidad.`,
        img: image4,
    },
];
---

<section class="accordion fade-up" id="our-process">
    {
        slides.map((s, i) => (
            <article
                class={`pane ${i === 0 ? "is-active" : ""}`}
                data-index={i + 1}
                style={`--bg-img: url(${s.img.src}); --content-h: 0px;`}
            >
                <button
                    class="tab-btn"
                    role="tab"
                    aria-selected={i === 0 ? "true" : "false"}
                    aria-controls={`panel-${i}`}
                    data-index={i + 1}
                >
                    <span>{s.name}</span>
                    <span class="dot" aria-hidden="true" />
                </button>

                <div
                    id={`panel-${i}`}
                    class="content"
                    role="tabpanel"
                    aria-labelledby={`pane-${i}`}
                >
                    <div class="content-inner">
                        <div class="card">
                            <h3>{s.name}</h3>
                            <p>{s.texto}</p>
                            <div class="underline" />
                        </div>
                    </div>
                </div>
            </article>
        ))
    }
</section>

<script type="module">
    document.addEventListener("DOMContentLoaded", () => {
        const root = document.documentElement;
        const panes = Array.from(document.querySelectorAll(".pane"));
        const tabs = Array.from(document.querySelectorAll(".tab-btn"));

        let currentIndex = 1;
        let intervalId;

        function measureAndSetHeight(pane, active) {
            const content = pane.querySelector(".content");
            const inner = pane.querySelector(".content-inner");
            if (!content || !inner) return;
            if (active) {
                const h = inner.scrollHeight;
                pane.style.setProperty("--content-h", `${h}px`);
            } else {
                pane.style.setProperty("--content-h", `0px`);
            }
        }

        function setActive(index) {
            currentIndex = index;

            panes.forEach((p, i) => {
                const active = i === index - 1;
                p.classList.toggle("is-active", active);

                const btn = p.querySelector(".tab-btn");
                if (btn)
                    btn.setAttribute(
                        "aria-selected",
                        active ? "true" : "false",
                    );

                const underline = p.querySelector(".underline");
                if (underline) {
                    underline.classList.remove("anim");
                    void underline.offsetWidth;
                    if (active) underline.classList.add("anim");
                }

                measureAndSetHeight(p, active);
            });

            panes.forEach((_, i) => {
                root.style.setProperty(
                    `--col${i + 1}`,
                    index === i + 1 ? "3fr" : "1fr",
                );
            });
        }

        function startAutoPlay() {
            if (intervalId) clearInterval(intervalId);
            intervalId = window.setInterval(() => {
                const next =
                    currentIndex === panes.length ? 1 : currentIndex + 1;
                setActive(next);
            }, 7000);
        }

        tabs.forEach((btn) => {
            btn.addEventListener("click", (e) => {
                e.stopPropagation();
                setActive(parseInt(btn.dataset.index || "1", 10));
                startAutoPlay();
            });
        });

        panes.forEach((pane, idx) => {
            pane.style.cursor = "pointer";
            pane.addEventListener("click", (e) => {
                if (e.target.closest("a, button, input, textarea, select"))
                    return;
                setActive(idx + 1);
                startAutoPlay();
            });
            // Activar por hover sin necesidad de clic
            let hoverTimeoutId;
            pane.addEventListener("mouseenter", () => {
                if (hoverTimeoutId) clearTimeout(hoverTimeoutId);
                hoverTimeoutId = window.setTimeout(() => setActive(idx + 1), 220);
            });
            pane.addEventListener("mouseleave", () => {
                if (hoverTimeoutId) {
                    clearTimeout(hoverTimeoutId);
                    hoverTimeoutId = undefined;
                }
            });

            const ro = new ResizeObserver(() => {
                const active = pane.classList.contains("is-active");
                if (active) measureAndSetHeight(pane, true);
            });
            const inner = pane.querySelector(".content-inner");
            if (inner) ro.observe(inner);
        });

        setActive(1);
        startAutoPlay();

        window.addEventListener("resize", () => {
            panes.forEach((p) => {
                const active = p.classList.contains("is-active");
                if (active) measureAndSetHeight(p, true);
            });
        });
    });
</script>

<style>
    :root {
        --col1: 3fr;
        --col2: 1fr;
        --col3: 1fr;
        --col4: 1fr;
        --dur-fast: 0.28s;
        --dur-med: 0.55s;
        --dur-slow: 0.9s;
        --ease-smooth: cubic-bezier(0.22, 1, 0.36, 1);
    }

    .accordion {
        margin: 100px 0 80px 0;
        width: min(1400px, 100%);
        min-height: 520px;
        display: grid;
        grid-template-columns: var(--col1) var(--col2) var(--col3) var(--col4);
        gap: 10px;
        align-items: stretch;
        transition: grid-template-columns var(--dur-slow) var(--ease-smooth);
    }

    .pane {
        --content-h: 0px;
        position: relative;
        overflow: hidden;
        border-radius: 16px;
        background: #0b1222;
        color: #eef2ff;
        isolation: isolate;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        display: grid;
        grid-template-rows: auto 1fr;
    }
    .pane::before {
        content: "";
        position: absolute;
        inset: 0;
        z-index: 0;
        background-image: var(--bg-img);
        background-size: cover;
        background-position: center;
        opacity: 0.55;
        transition:
            opacity var(--dur-med) var(--ease-smooth),
            transform var(--dur-med) var(--ease-smooth);
    }
    .pane.is-active::before {
        opacity: 0.75;
    }

    .tab-btn {
        position: relative;
        z-index: 1;
        background: transparent;
        color: #fff;
        padding: 14px 16px;
        cursor: pointer;
        border: none;
        text-align: left;
        font-weight: 700;
        font-size: clamp(12px, 1.6vw, 14px);
        letter-spacing: 0.3px;
        display: flex;
        align-items: center;
        gap: 10px;
        transition:
            opacity var(--dur-slow) var(--ease-smooth),
            visibility var(--dur-slow) step-end;
    }
    .tab-btn .dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: transparent;
        border: 1px solid #dbe3ff;
    }

    .pane:not(.is-active) .tab-btn {
        writing-mode: vertical-rl;
        text-orientation: mixed;
        transform: rotate(180deg);
        align-items: flex-end;
        justify-content: flex-start;
        padding: 12px 10px;
        height: 100%;
    }

    .content {
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1;
        padding: 0 20px 20px;
        overflow: hidden;
        height: var(--content-h);
        transition:
            height var(--dur-med) var(--ease-smooth),
            padding var(--dur-med) var(--ease-smooth);
    }
    .content-inner {
        opacity: 0;
        transform: translateY(10px);
        transition:
            opacity var(--dur-med) var(--ease-smooth),
            transform var(--dur-med) var(--ease-smooth);
    }
    .pane.is-active .content {
        padding: 30px;
    }
    .pane.is-active .content-inner {
        opacity: 1;
        transform: translateY(0);
    }

    .pane .tab-btn {
        opacity: 1;
        visibility: visible;
    }
    .pane.is-active .tab-btn {
        opacity: 0;
        visibility: hidden;
    }

    .card {
        background: rgba(255, 255, 255, 0.08);
        backdrop-filter: blur(6px);
        border: 1px solid rgba(255, 255, 255, 0.25);
        border-radius: 14px;
        padding: 22px 24px;
        position: relative;
        overflow: hidden;
    }
    .card h3 {
        margin: 0 0 8px;
        font-size: clamp(18px, 2vw, 22px);
        color: #dbe3ff;
    }
    .card p {
        margin: 0 0 12px;
        line-height: 1.55;
        font-size: clamp(14px, 1.8vw, 16px);
    }

    .pane.is-active .card {
        animation: cardIn var(--dur-slow) var(--ease-smooth) both;
        box-shadow: 0 14px 40px rgba(0, 0, 0, 0.28);
    }
    .pane.is-active .card::after {
        content: "";
        position: absolute;
        inset: -20% -40%;
        background: linear-gradient(
            120deg,
            rgba(255, 255, 255, 0) 0%,
            rgba(255, 255, 255, 0.18) 45%,
            rgba(255, 255, 255, 0) 100%
        );
        filter: blur(8px);
        pointer-events: none;
        animation: glowSweep 0.7s var(--ease-smooth) 0.09s both;
    }
    .pane.is-active .card h3 {
        animation: fadeUp var(--dur-med) var(--ease-smooth) both;
    }
    .pane.is-active .card p {
        animation: fadeUp var(--dur-med) var(--ease-smooth) 90ms both;
    }

    .underline {
        width: 100%;
        height: 3px;
        background: linear-gradient(90deg, #7c8bd6, #7c8bd6);
        border-radius: 10px;
    }
    .underline.anim {
        animation: fillBar 7s linear forwards;
    }
    @keyframes fillBar {
        from {
            width: 0;
        }
        to {
            width: 100%;
        }
    }
    @keyframes cardIn {
        0% {
            opacity: 0;
            transform: translateY(12px) scale(0.965);
            filter: blur(6px);
        }
        60% {
            opacity: 1;
            transform: translateY(0) scale(1.015);
            filter: blur(1.5px);
        }
        100% {
            opacity: 1;
            transform: translateY(0) scale(1);
            filter: blur(0);
        }
    }
    @keyframes fadeUp {
        from {
            opacity: 0;
            transform: translateY(8px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    @keyframes glowSweep {
        0% {
            transform: translateX(-120%) rotate(8deg);
            opacity: 0;
        }
        30% {
            opacity: 0.6;
        }
        100% {
            transform: translateX(140%) rotate(8deg);
            opacity: 0;
        }
    }

    @media (max-width: 1200px) {
        :root {
            --col1: 2.5fr;
            --col2: 1fr;
            --col3: 1fr;
            --col4: 1fr;
        }
    }

    @media (max-width: 900px) {
        .accordion {
            grid-template-columns: 1fr 1fr;
            grid-auto-rows: minmax(260px, auto);
        }
        .pane:not(.is-active) .tab-btn {
            writing-mode: initial;
            transform: none;
            height: auto;
            align-items: center;
            padding: 14px 16px;
        }
        .pane.is-active .tab-btn {
            opacity: 1;
            visibility: visible;
        }
        .pane.is-active .content {
            padding: 14px;
        }
    }

    @media (max-width: 640px) {
        .accordion {
            display: block;
            gap: 10px;
        }
        .pane {
            margin: 10px;
        }
        .pane::before {
            opacity: 0.6;
        }
        .tab-btn {
            font-size: 15px;
        }
        .card {
            padding: 18px 16px;
        }
        .pane.is-active .content {
            padding: 14px;
        }
    }

    @media (prefers-reduced-motion: reduce) {
        .accordion,
        .pane::before,
        .tab-btn,
        .content,
        .content-inner {
            transition: none !important;
            animation: none !important;
        }
    }
</style>

<Monday />
